# Pipeline for annotating DNA contigs

## Raw contigs
First set of data is the reads from the sequencer, assembled into many contigs.

This produces `candida_boidinii.fa`.

## Diamond blast against NCBI non-redundant database
Second set of data is generated by using diamond to compare the contigs you have against the nr database to find known genes.

```
./diamond makedb --in nr -d nr_ref
./diamond blastx -d nr_ref.dmnd -q candida_boidinii.fa -o blastx_nr_boidinii.m8 -p 8
```

This produces `blastx_nr_boidinii.m8`.

## Select best matches from blast
Using awk pull out only the best matches from diamond.

```
awk '!_[$1]++ {print}' blastx_nr_boidinii.m8 > boidinii_best.m8
```
This produces `boidinii_best.m8`.

##  Get uniprot IDs and proteins
Use awk to get the list of RefSeq protein IDs from the blast results

```
awk '{print $2}' boidinii_best_blast.m8 | xclip
```

Then paste it into the [uniprot look up](http://www.uniprot.org/uploadlists/) and search for RefSeq Protein -> UniProtKB 

Download the Mapping Table file, to get a list of the IDs that correspond to uniprot IDs.

Also download the fasta format of all the proteins found.

This produces `boidinii_uniprot.fa` & `boidinii_uniprot_ids.lst`.

## Merge the data into a working file
Using Vim macro's it is simple to combine the found data into a copy of the original fasta file.

The gene is now annotated with the original scaffold, the blast result, and the uniprot ID.

```
>scaffold4 61.0 | XP_018211803.1  81.6  1170  213 2 517198  513695  1 1170  0.0e+00 1953.7 | A0A1B7SK73
CCTGATGAACCAGAGGCACCAGTGGAGTCTGAAGCACCAGAAGCACCTGAGGAAGCACCAGATGAAGCGGAGGCACCAGTGGAAGAAGAAGCACCAGTGG
AAGAAGAAGCGCCAGATGATGAGGAGGCAACAGTNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN
```

It is easy to do this with a Vim Macro, however if I want to make this an accessible & repeatable process then a small python script should be able to handle this task.

This produces `boidinii_working.fa`.

## Extract gene sequence from blast results
Need to find the start and end of the gene in the contig, from the blast results and add that to the database.

## Add UniprotID -> KeggID
???

## Create a database with the found data
Now we have two files that need to be ingest into a database. The `boidinii_working.fa` & `boidinii_uniprot.fa` files should contain all the data that the website needs. 

I have created a script to put this data into MongoDB. 

*This is where I am at.*

## Build a web front end
Then I just have to make a web front end to make this data accessible, including viewing, searching and comparing genes across the species.
